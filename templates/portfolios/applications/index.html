{% from "components/icon.html" import Icon %}
{% from "components/empty_state.html" import EmptyState %}

{% extends "portfolios/base.html" %}

{% set can_create_applications = user_can(permissions.ADD_APPLICATION_IN_PORTFOLIO) %}

{% block portfolio_content %}

<div class='portfolio-applications'>
  <div class='portfolio-applications__header row'>
    <div class='portfolio-applications__header--title col col--grow'>Applications</div>
    <div class='portfolio-applications__header--actions col'>
      {% if can_create_applications %}
        <a class='icon-link' href='{{ url_for('portfolios.new_application', portfolio_id=portfolio.id) }}'>
          Add A New Application
          {{ Icon("plus", classes="sidenav__link-icon") }}
        </a>
      {% endif %}
    </div>
  </div>

  {% if not portfolio.applications %}

    {{ EmptyState(
      'This portfolio doesnâ€™t have any applications yet.',
      action_label='Add a New Application' if can_create_applications else None,
      action_href=url_for('portfolios.new_application', portfolio_id=portfolio.id) if can_create_applications else None,
      icon='cloud',
      sub_message=None if can_create_applications else 'Please contact your JEDI Cloud portfolio administrator to set up a new application.'
    ) }}

  {% else %}

    <div class='application-list'>
      {% for application in portfolio.applications %}
        <div v-cloak class='accordian application-list-item'>
          <header class='accordian__header row'>
            <div class='col col-grow'>
              <h3 class='accordian__title'>{{ application.name }}</h3>
              <span class='accordian__description'>{{ application.description }}</span>
              <div class='accordian__actions'>
                {% if user_can(permissions.RENAME_APPLICATION_IN_PORTFOLIO) %}
                  <a class='icon-link' href='{{ url_for("portfolios.edit_application", portfolio_id=portfolio.id, application_id=application.id) }}'>
                    <span>App Settings</span>
                  </a>
                  <div class='separator'></div>
                {% endif %}
                <a class='icon-link' href='{{ url_for("portfolios.edit_application", portfolio_id=portfolio.id, application_id=application.id) }}'>
                  <span>Team</span>
                  <span class='counter'>11</span>
                </a>
              </div>
            </div>
            <div class='col'>
              <a href='#' class='icon-link'>{{ Icon('plus') }}</a>
            </div>
          </header>
          <ul>
            {% for environment in application.environments %}
              <li class='accordian__item application-list-item__environment'>
                <a href='{{ url_for("portfolios.access_environment", portfolio_id=portfolio.id, environment_id=environment.id)}}' target='_blank' rel='noopener noreferrer' class='application-list-item__environment__link'>
                  {{ Icon('link') }}
                  <span>{{ environment.name }}</span>
                </a>

                <div class='application-list-item__environment__members'>
                  <div class='label'>{{ environment.num_users }}</div>
                  <span>members</span>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </div>

  {% endif %}

</div>

{% endblock %}
