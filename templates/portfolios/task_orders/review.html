{% from "components/icon.html" import Icon %}
{% from "components/modal.html" import Modal %}
{% from "components/semi_collapsible_text.html" import SemiCollapsibleText %}
{% from "components/sticky_cta.html" import StickyCTA %}
{% from "components/submit_confirmation.html" import SubmitConfirmation %}
{% from "components/totals_box.html" import TotalsBox %}

{% extends 'portfolios/base.html' %}

{% block portfolio_content %}
  {% set submit_modal_id = "submit-to-1" %}
  {% call Modal(name=submit_modal_id) %}
    {{
      SubmitConfirmation(
        modal_id=submit_modal_id,
        submit_text="Confirm & Submit",
        submit_action=url_for('task_orders.submit_task_order', task_order_id=task_order.id),
        form=signature_form,
        task_order=task_order,
      )
    }}
  {% endcall %}

  {% call StickyCTA(text="Review Funding") %}
      <a href="{{ url_for("task_orders.edit", portfolio_id=portfolio.id, task_order_id=task_order.id) }}" class="usa-button usa-button-secondary" type="submit">Edit</a>
      <a v-on:click="openModal('submit-to-1')" class="usa-button usa-button-primary" type="submit">Submit task order</a>
  {% endcall %}

  <div class="task-order-summary">

    {{ SemiCollapsibleText() }}

    <hr>

  <div class="h1">
    {{ "task_orders.review.review_your_task_order" | translate }}
  </div>
  <p>
    {{ "task_orders.review.check_paragraph" | translate }}
  </p>
  <div class="row">
    <div class="col">
      <div class="h4">
        {{ "task_orders.review.task_order_number" | translate }}
      </div>
      <div>{{task_order.number}}</div>

      <hr>

      <div class="h3">
        {{ "task_orders.review.funding_summary" | translate }}
      </div>

      {% for clin in task_order.clins %}
        <div>
          {{ "{}".format(clin.jedi_clin_type) | translate}}
        </div>
        <table>
          <thead>
            <tr>
              <th>{{ "task_orders.review.clins.amount" | translate }}</th>
              <th>{{ "task_orders.review.clins.obligated" | translate }}</th>
              <th>{{ "task_orders.review.clins.pop_start" | translate }}</th>
              <th>{{ "task_orders.review.clins.pop_end" | translate }}</th>
              <th>{{ "task_orders.review.clins.loa" | translate }}</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>{{ clin.obligated_amount | dollars }}</td>
              <td>
                {% if clin.is_obligated() %}
                  {{ "common.yes" | translate }}
                {% else %}
                  {{ "common.no" | translate }}
                {% endif %}
              </td>
              <td>{{ clin.start_date | formattedDate }}</td>
              <td>{{ clin.end_date | formattedDate }}</td>
              <td>
                {% for loa in clin.loas %}
                  {{ loa }}
                  <br />
                {% endfor %}
              </td>
            </tr>
          </tbody>
        </table>
      {% endfor %}

      <hr>

      <div class="h3">
        {{ "task_orders.review.supporting_document.title" | translate }}
      </div>
      <div class="h4">
        <a class="icon-link icon-link--download" href="{{ url_for('task_orders.download_task_order_pdf', task_order_id=task_order.id) }}">
          {{ Icon('check-circle-solid') }}
          {{ task_order.pdf.filename }}
        </a>
      </div>
    </div>

    {{ TotalsBox(task_order=task_order) }}

  </div>

  </div>
{% endblock %}
