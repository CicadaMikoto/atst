{% macro RequiredLabel() -%}
  <span class='label label--error'>Response Required</span>
{%- endmacro %}

{% macro DefinitionReviewField(title, section, item_name, filter=None, filter_args=[]) -%}
  <div>
    <dt>{{ title }}</dt>
    <dd>
      {% if data[section] and data[section][item_name] %}
        {{ data[section][item_name] | findFilter(filter, filter_args) }}
      {% else %}
        {{ RequiredLabel() }}
      {% endif %}
    </dd>
  </div>
{% endmacro %}


<hr>
<h2>
  Details of Use
  {% if editable %}
  <a href="{{ url_for('requests.requests_form_update', screen=1, request_id=request_id) }}" class="icon-link">
    {{ Icon('edit') }}
    <span>Edit this section</span>
  </a>
  {% endif %}
</h2>

<dl>

  {{ DefinitionReviewField("DoD Component", "details_of_use", "dod_component", filter="getOptionLabel", filter_args=[service_branches]) }}

  {{ DefinitionReviewField("JEDI Usage", "details_of_use", "jedi_usage") }}

  {{ DefinitionReviewField("Number of software systems", "details_of_use", "num_software_systems", filter="readableInteger") }}

  {{ DefinitionReviewField("JEDI Migration", "details_of_use", "jedi_migration") }}

  {% if data['details_of_use']['jedi_migration'] == 'yes' %}
    {{ DefinitionReviewField("Rationalization of Software Systems", "details_of_use", "rationalization_software_systems") }}

    {{ DefinitionReviewField("Technical Support Team", "details_of_use", "technical_support_team") }}

    {% if data['details_of_use']['technical_support_team'] == 'yes' %}
      {{ DefinitionReviewField("Organization Providing Assistance", "details_of_use", "organization_providing_assistance", filter="getOptionLabel", filter_args=[assistance_org_types]) }}
    {% endif %}

    {{ DefinitionReviewField("Engineering Assessment", "details_of_use", "engineering_assessment") }}

    {{ DefinitionReviewField("Data Transfers", "details_of_use", "data_transfers", filter="getOptionLabel", filter_args=[data_transfer_amounts]) }}

    {{ DefinitionReviewField("Expected Completion Date", "details_of_use", "expected_completion_date", filter="getOptionLabel", filter_args=[completion_date_ranges]) }}

  {% else %}

    {{ DefinitionReviewField("Cloud Native", "details_of_use", "cloud_native") }}

  {% endif %}

  {{ DefinitionReviewField("Estimated Monthly Spend", "details_of_use", "estimated_monthly_spend", filter="dollars") }}

  {% if jedi_request and jedi_request.annual_spend > annual_spend_threshold %}

    {{ DefinitionReviewField("Number of User Sessions", "details_of_use", "number_user_sessions", filter="readableInteger") }}

    {{ DefinitionReviewField("Average Daily Traffic (Number of Requests)", "details_of_use", "average_daily_traffic", filter="readableInteger") }}

    {{ DefinitionReviewField("Average Daily Traffic (GB)", "details_of_use", "average_daily_traffic_gb", filter="readableInteger") }}

  {% endif %}

  {{ DefinitionReviewField("Total Spend", "details_of_use", "dollar_value", filter="dollars") }}

  {{ DefinitionReviewField("Start Date", "details_of_use", "start_date") }}
</dl>

<hr>
<h2>
  Information About You
  {% if editable %}
  <a href="{{ url_for('requests.requests_form_update', screen=2, request_id=request_id) }}" class="icon-link">
    {{ Icon('edit') }}
    <span>Edit this section</span>
  </a>
  {% endif %}
</h2>

<dl>
  {{ DefinitionReviewField("First Name", "information_about_you", "fname_request") }}

  {{ DefinitionReviewField("Last Name", "information_about_you", "lname_request") }}

  {{ DefinitionReviewField("Email Address", "information_about_you", "email_request") }}

  {{ DefinitionReviewField("Phone Number", "information_about_you", "phone_number", filter="usPhone") }}

  {{ DefinitionReviewField("Service Branch or Agency", "information_about_you", "service_branch", filter="getOptionLabel", filter_args=[service_branches]) }}

  {{ DefinitionReviewField("Citizenship", "information_about_you", "citizenship") }}

  {{ DefinitionReviewField("Designation of Person", "information_about_you", "designation", filter="capitalize") }}

  {{ DefinitionReviewField("Latest Information Assurance (IA) Training completion date", "information_about_you", "date_latest_training") }}
</dl>

<hr>
<h2>
  Workspace Owner
  {% if editable %}
  <a href="{{ url_for('requests.requests_form_update', screen=3, request_id=request_id) }}" class="icon-link">
    {{ Icon('edit') }}
    <span>Edit this section</span>
  </a>
  {% endif %}
</h2>

<dl>
  {{ DefinitionReviewField("POC First Name", "primary_poc", "fname_poc") }}

  {{ DefinitionReviewField("POC Last Name", "primary_poc", "lname_poc") }}

  {{ DefinitionReviewField("POC Email Address", "primary_poc", "email_poc") }}

  {{ DefinitionReviewField("DOD ID", "primary_poc", "dodid_poc") }}
</dl>


