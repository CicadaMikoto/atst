#!/bin/bash

# script/sync-crls: update the DOD CRLs and place them where authnid expects them
set -e
cd "$(dirname "$0")/.."

if [[ $# -eq 0 ]]; then
  TMP_DIR=crl-tmp
else
  TMP_DIR=$1
fi

mkdir -p $TMP_DIR
pipenv run python ./atst/domain/authnid/crl/util.py $TMP_DIR crl
mkdir -p crl
rsync -rq --min-size 400 $TMP_DIR/. crl/.
rm -rf $TMP_DIR

if [[ $FLASK_ENV != "prod" ]]; then
  # place our test CRL there
  cp ssl/client-certs/client-ca.der.crl crl/
fi
